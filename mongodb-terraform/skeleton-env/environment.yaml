# =============================================================================
# MongoDB Atlas Workspace: ${{ values.environment }}
# Application: ${{ values.applicationName }}
# Generated by Backstage Scaffolder
# =============================================================================

name: ${{ values.applicationName }}
environment: ${{ values.environment }}

# -----------------------------------------------------------------------------
# MongoDB Atlas Cluster Configuration
# NOTE: Only REPLICASET is supported (SHARDED disabled due to upstream module bug).
# Cloud provider is always AZURE. Auto-scaling is always enabled.
# -----------------------------------------------------------------------------
cluster:
  region: ${{ values.clusterRegion }}
  default_instance_size: ${{ values.instanceSize }}

# -----------------------------------------------------------------------------
# Azure Configuration
# -----------------------------------------------------------------------------
azure:
  # Azure AD Group IDs for RBAC
  # dev_group_id: Project Read access
  # lead_group_id: Project Owner access
  dev_group_id: "${{ values.devGroupId }}"
  lead_group_id: "${{ values.leadGroupId }}"

  # PrivateLink endpoints (azure_location + subnet_id pairs)
  privatelink_endpoints:
{%- for endpoint in values.privatelinkEndpoints %}
    - azure_location: ${{ endpoint.azureLocation }}
      subnet_id: "${{ endpoint.subnetId }}"
{%- endfor %}

# -----------------------------------------------------------------------------
# Network Access Configuration (Optional)
# -----------------------------------------------------------------------------
network:
  # IP/CIDR Access List - allows connections from these addresses
  # Leave empty for PrivateLink-only access
  access_cidrs:
{%- if values.accessCidrs and values.accessCidrs.length > 0 %}
{%- for cidr in values.accessCidrs %}
    - "${{ cidr }}"
{%- endfor %}
{%- else %}
    []
{%- endif %}
